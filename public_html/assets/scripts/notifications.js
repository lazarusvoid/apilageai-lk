document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("notificationBell"),e=document.getElementById("notificationDropdown"),n=document.getElementById("notificationCount"),i=document.getElementById("notificationList"),o=document.getElementById("clearNotifications");let a=!1;const c="https://apilageai.lk/notific.php";async function l(){try{const t=await fetch(`${c}?action=get`,{cache:"no-cache"}),e=await t.json();i.innerHTML="",Array.isArray(e)&&0!==e.length?(n.textContent=e.length,n.style.display="inline",e.forEach((t=>{const e=document.createElement("li");var n;e.innerHTML=`\n            <span>${n=t.message,n.replace(/[&<>"']/g,(function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[t]}))}</span>\n            <button class="delete-btn" data-id="${t.id}" title="Delete">&times;</button>\n          `,i.appendChild(e)}))):(i.innerHTML="<li class='no-notification'>No notifications</li>",n.style.display="none")}catch(t){console.error("Failed to load notifications:",t)}}async function s(){try{const t=await fetch(`${c}?action=get`,{cache:"no-cache"}),e=await t.json();Array.isArray(e)&&e.length>0?(n.textContent=e.length,n.style.display="inline"):n.style.display="none"}catch(t){console.error("Failed to refresh notification count:",t)}}t.addEventListener("click",(()=>{a=!a,e.style.display=a?"block":"none",a&&l()})),i.addEventListener("click",(t=>{if(t.target.classList.contains("delete-btn")){const e=t.target.dataset.id;fetch(`${c}?action=delete&id=${e}`).then((()=>l())).catch((t=>console.error("Delete error:",t)))}})),o.addEventListener("click",(()=>{fetch(`${c}?action=clear`).then((()=>l())).catch((t=>console.error("Clear error:",t)))})),document.addEventListener("click",(n=>{t.contains(n.target)||e.contains(n.target)||(e.style.display="none",a=!1)})),setInterval((()=>{s()}),3e4),s()}));