document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#image-gallery .image-grid"),t=document.getElementById("search-input"),a=document.querySelectorAll("[data-tab]"),n=document.getElementById("sidebar-toggle"),s=document.querySelector(".main-container"),i=document.getElementById("theme-toggle"),l=document.getElementById("theme-icon"),c=document.createElement("div");c.className="modal-overlay",document.body.appendChild(c);const o=document.documentElement;let d="explore";const r=localStorage.getItem("theme"),u=window.matchMedia("(prefers-color-scheme: dark)").matches,m=r||(u?"dark":"light");async function p(e,t){const a=await fetch(`https://apilageai.lk/react_image.php?id=${e}&type=${t}`,{credentials:"include"});return await a.json()}async function g(t="explore"){e.innerHTML='<p style="text-align:center;">Loading...</p>';const a=await async function(e){const t="friends"===e?"https://apilageai.lk/public_images.php":"https://apilageai.lk/images.php",a=await fetch(t,{credentials:"include"});return(await a.json()).images||[]}(t);e.innerHTML="",a&&a.length?a.forEach((a=>{const n=document.createElement("div");n.className="image-wrapper",n.innerHTML=`\n        <img src="${a.image_url}" alt="Image" class="gallery-image" data-id="${a.id}" data-url="${a.image_url}" data-prompt="${a.prompt||""}" data-author="${a.author_name||"Unknown"}" data-likes="${a.likes}" data-unlikes="${a.unlikes}" />\n        <div class="image-overlay">\n          <p class="prompt">${(a.prompt||"").split(" ").slice(0,10).join(" ")}...</p>\n          ${"friends"===t?`\n              <div class="like-box">\n                <button class="like-btn" data-id="${a.id}">\n                  <i class="fas fa-heart"></i> <span>${a.likes}</span>\n                </button>\n                <button class="unlike-btn" data-id="${a.id}">\n                  <i class="fas fa-thumbs-down"></i> <span>${a.unlikes}</span>\n                </button>\n              </div>`:`\n              <div class="owner-actions">\n                <span>‚ù§Ô∏è ${a.likes}</span> <span>üíî ${a.unlikes}</span>\n                <button class="pub-btn" data-id="${a.id}" data-public="${a.public}">\n                  ${1==a.public?"Unpublish":"Publish"}\n                </button>\n                <button class="del-btn" data-id="${a.id}">Delete</button>\n              </div>`}\n        </div>`,e.appendChild(n)})):e.innerHTML='<p style="text-align:center;">You are fresh to here, Ask apilageai to genarte some image and click publish on CHAT page</p>'}function h(){c.classList.remove("active"),document.body.classList.remove("modal-open"),c.innerHTML=""}o.setAttribute("data-theme",m),l.className="dark"===m?"fas fa-sun":"fas fa-moon",i.addEventListener("click",(()=>{const e="dark"===o.getAttribute("data-theme")?"light":"dark";o.setAttribute("data-theme",e),l.className="dark"===e?"fas fa-sun":"fas fa-moon",localStorage.setItem("theme",e)})),n.addEventListener("click",(()=>{s.classList.toggle("sidebar-minimized");n.querySelector("i").className=s.classList.contains("sidebar-minimized")?"fas fa-chevron-right":"fas fa-chevron-left"})),a.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),a.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),d=e.dataset.tab,g(d)}))})),e.addEventListener("click",(async t=>{const a=t.target.closest(".gallery-image"),n=t.target.closest(".like-btn"),s=t.target.closest(".unlike-btn"),i=t.target.closest(".pub-btn"),l=t.target.closest(".del-btn");if(a&&function(e){const t=e.dataset.url,a=e.dataset.prompt,n=e.dataset.author,s=e.dataset.likes,i=e.dataset.unlikes;c.innerHTML=`\n      <div class="modal-container active">\n        <div class="modal-content">\n          <button class="modal-close-btn">&times;</button>\n          <img src="${t}" class="modal-full-image" />\n          <div class="modal-info">\n            <p class="modal-prompt">${a}</p>\n            <p class="modal-author">By: ${n}</p>\n            <div class="modal-stats">\n              <span>‚ù§Ô∏è ${s}</span>\n              <span>üíî ${i}</span>\n            </div>\n            <div class="modal-actions">\n              <button class="modal-btn" id="copy-url"><i class="fas fa-link"></i> Copy URL</button>\n              <button class="modal-btn" id="share-img"><i class="fas fa-share-alt"></i> Share</button>\n              <a class="modal-btn primary" id="download-img" href="${t}" download><i class="fas fa-download"></i> Download</a>\n            </div>\n          </div>\n        </div>\n      </div>`,c.classList.add("active"),document.body.classList.add("modal-open"),c.querySelector(".modal-close-btn").addEventListener("click",h),c.addEventListener("click",(e=>{e.target===c&&h()})),c.querySelector("#copy-url").addEventListener("click",(()=>{navigator.clipboard.writeText(t),alert("Image URL copied!")})),c.querySelector("#share-img").addEventListener("click",(async()=>{navigator.share?await navigator.share({title:"Apilage AI Image",text:a,url:t}):alert("Share not supported on this device.")}))}(a),n){const t=await p(n.dataset.id,"like");if(t.success){n.querySelector("span").textContent=t.likes;const a=e.querySelector(`.unlike-btn[data-id="${n.dataset.id}"]`);a&&(a.querySelector("span").textContent=t.unlikes),n.classList.toggle("active"),a&&a.classList.remove("active")}}if(s){const t=await p(s.dataset.id,"unlike");if(t.success){s.querySelector("span").textContent=t.unlikes;const a=e.querySelector(`.like-btn[data-id="${s.dataset.id}"]`);a&&(a.querySelector("span").textContent=t.likes),s.classList.toggle("active"),a&&a.classList.remove("active")}}if(i){const e=i.dataset.id,t="0"===i.dataset.public,a=await async function(e,t){const a=await fetch(`https://apilageai.lk/update_image_public.php?id=${e}&public=${t?1:0}`,{credentials:"include"});return await a.json()}(e,t);a.success&&(i.textContent=t?"Unpublish":"Publish",i.dataset.public=t?"1":"0")}if(l&&confirm("Delete this image?")){(await async function(e){const t=await fetch(`https://apilageai.lk/delete_image.php?id=${e}`,{credentials:"include"});return await t.json()}(l.dataset.id)).success&&l.closest(".image-wrapper").remove()}})),t.addEventListener("input",(e=>{const t=e.target.value.toLowerCase();document.querySelectorAll(".image-wrapper").forEach((e=>{const a=e.querySelector(".prompt")?.textContent.toLowerCase()||"";e.style.display=a.includes(t)?"":"none"}))})),g()}));