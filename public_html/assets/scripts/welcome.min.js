const typingSound = new Audio('https://apilageai.lk/assets/sounds/typing.mp3');
typingSound.loop = true;
const brandName = document.getElementById('brandName');
const navdropIcon = document.getElementById('navdropIcon');
const navdropMenu = document.getElementById('navdropMenu');
const languageOption = document.getElementById('languageOption');

const urlParams = new URLSearchParams(window.location.search);
const query = urlParams.get('q');

if (query) {
    const messageInput = document.getElementById('message-input');
    if (messageInput) {
        messageInput.value = query;
        messageInput.focus();
    }
}

function setGreeting() {
    const hour = new Date().getHours();
    let greeting = '';

    if (hour >= 3 && hour < 12) {
        greeting = 'Good morning ðŸŒ»';
    } else if (hour >= 12 && hour < 16) {
        greeting = 'Good afternoon ðŸŒž';
    } else if (hour >= 16 && hour < 20) {
        greeting = 'Good evening ðŸŒ¥ï¸';
    } else if (hour >= 20 && hour < 24) {
        greeting = 'Happy late night ðŸŒ™';
    } else {
        greeting = 'A new day ðŸŒ…'; // 12am to 3am
    }

    const greetingElement = document.querySelector('.greeting-text');
    if (greetingElement) {
        greetingElement.textContent = `${greeting},`;
    }
}

document.addEventListener("DOMContentLoaded", function () {
    const banners = [
        {
            text: "A new update, Now apilage Ai can suggest you youtube video's and , Images from Google !",
            img: "https://apilageai.lk/assets/images/upd.png"
        },
        {
            text: "Download Apilage AI on Play Store!, Only for ðŸ‡±ðŸ‡° users, enjoy Your chat !",
            img: "https://apilageai.lk/assets/images/ps.png"
        },
        {
            text: "For better chat, memory is now saved more advanced!, try saying 'I like Kottu so much !'",
            img: "https://apilageai.lk/assets/images/brain.png"
        }
    ];

    let currentBanner = 0;
    let textEl = document.getElementById("typedText");
    let imgEl = document.getElementById("bannerImage");
    let typingInterval = null;
    let autoSwitchTimeout = null;

    function typeText(text, callback) {
        if (typingInterval) clearInterval(typingInterval);
        if (autoSwitchTimeout) clearTimeout(autoSwitchTimeout);

        textEl.textContent = "";
        textEl.style.borderRight = "3px solid #ccc";
        let i = 0;
        const speed = 40;

        typingInterval = setInterval(() => {
            if (i >= text.length) {
                clearInterval(typingInterval);
                textEl.style.borderRight = "none";
                autoSwitchTimeout = setTimeout(() => {
                    currentBanner = (currentBanner + 1) % banners.length;
                    showBanner(currentBanner);
                }, 2000);
            } else {
                textEl.textContent += text.charAt(i);
                i++;
            }
        }, speed);
    }

    function showBanner(index) {
        const banner = banners[index];
        if (imgEl) imgEl.src = banner.img;
        if (textEl) typeText(banner.text);
    }

    // Auto start
    showBanner(currentBanner);

    // Manual toggle
    document.querySelectorAll(".toggle-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
            const index = parseInt(btn.dataset.index);
            currentBanner = index;
            showBanner(index);
        });
    });
});

function updateCardTitles() {
    const titles = document.querySelectorAll('.card-title');
    const englishTitles = [
        'Teach me about the Quadratic Formula',
        'Graph the function f(x)= sin(x)',
        'Explain photosynthesis'
    ];

    titles.forEach((title, index) => {
        title.textContent = englishTitles[index];
    });
}

// Toggle navdrop menu
navdropIcon.addEventListener('click', () => {
    navdropMenu.style.display = navdropMenu.style.display === 'block' ? 'none' : 'block';
});

// Hide navdrop when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.brand-wrapper')) {
        navdropMenu.style.display = 'none';
    }
});
